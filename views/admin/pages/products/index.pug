extends ../../layouts/default.pug
include ../../mixins/filter-status.pug
include ../../mixins/search.pug
include ../../mixins/pagination.pug
include ../../mixins/form-change-multi.pug
include ../../mixins/alert.pug
include ../../mixins/sort.pug

block main 
    if(role.permissions.includes("products_view"))
        +alert-success(5000)
        +alert-error(5000)

        .container.mb-5
            h1.display-4.text-center Danh sach san pham

        .card.mb-3 
            .card-header Bo loc va tim kiem 
            .card-body 
                .row.align-items-center.justify-content-between
                    .col-3
                        +filter-status(filterStatus)
                    .col-3   
                        +sort(sort)
                    .col-4
                        +search(keyword)  

        .card.mb-3 
            .card-header Danh sach
            .card-body
                .row
                    .col-8
                        if(role.permissions.includes("products_edit"))
                            +form-change-multi(`${prefixAdmin}/products/change-multi?_method=PATCH`)
                    .col-4
                        if(role.permissions.includes("products_create")) 
                            a(
                                href=`${prefixAdmin}/products/create`
                                class="btn btn-outline-success"
                            ) + Them moi

                table(class="table table-hover table-sm" checkbox-multi)
                    thead  
                        tr
                            th 
                                input(type="checkbox" name="checkAll")
                            th STT 
                            th Hinh anh 
                            th Tieu de 
                            th Gia 
                            th Vi tri
                            th Trang thai 
                            th Nguoi tao
                            th Nguoi cap nhat
                            th Hanh dong
                    tbody 
                        each item, index in products 
                            tr 
                                td 
                                    input(type="checkbox" name="id" value=item.id)
                                td #{pagination.limitItems * (pagination.currentPage - 1) + index + 1}
                                td 
                                    img(src=item.thumbnail, alt=item.title, width="100px", height="auto")
                                td #{item.title}
                                td #{item.price}$
                                td
                                    input(
                                        type="number"
                                        value=item.position
                                        style="width: 60px"
                                        min="1"
                                        name="position"
                                    )
                                td 
                                    if(role.permissions.includes("products_edit"))   
                                        if(item.status == "active") 
                                            a(href="javascript:", button-change-status, data-status=item.status, data-id=item.id, class="badge badge-success") Hoat dong 
                                        else    
                                            a(href="javascript:", button-change-status, data-status=item.status, data-id=item.id, class="badge badge-danger") Dung hoat dong
                                    else 
                                        if(item.status == "active")
                                            button( 
                                                class="badge badge-success" 
                                                data-status=item.status
                                                data-id=item.id
                                            ) Hoạt động
                                        else
                                            button(
                                                class="badge badge-danger" 
                                                data-status=item.status
                                                data-id=item.id
                                            ) Dừng hoạt động
                                td 
                                    p #{item.accountFullName}
                                    p #{dayjs(item.createdBy.createdAt).format("DD/MM/YYYY HH:mm:ss")}
                                td 
                                    if(item.updatedBy.length > 0)
                                        p #{item.updatedBy[item.updatedBy.length-1].accountFullName}
                                        p #{dayjs(item.updatedBy[item.updatedBy.length-1].updatedAt).format("DD/MM/YYYY HH:mm:ss")}
                                td 
                                    a(
                                        href=`${prefixAdmin}/products/detail/${item.id}`
                                        class="btn btn-secondary btn-sm"
                                    ) Chi tiet
                                    if(role.permissions.includes("products_edit"))
                                        a(
                                            href=`${prefixAdmin}/products/edit/${item.id}`
                                            class="btn btn-warning btn-sm"
                                        ) Sua
                                    if(role.permissions.includes("products_delete"))
                                        button(class="btn btn-danger btn-sm ml-1" data-id=item.id button-delete) Xoa

        +pagination(pagination)

        form(action="" method="POST" id="form-change-status" data-path=`${prefixAdmin}/products/change-status`) 

        form(action="" method="POST" id="form-delete-item" data-path=`${prefixAdmin}/products/delete`)

        script(src="/admin/js/product.js")



